import org.gradle.nativeplatform.platform.internal.DefaultNativePlatform

def detectPlatform() {
    if(DefaultNativePlatform.currentOperatingSystem.isWindows()) {
        return "windows"
    } else if(DefaultNativePlatform.currentOperatingSystem.isLinux()) {
        return "linux"
    } else if(DefaultNativePlatform.currentOperatingSystem.isMacOsX()) {
        return "macos"
    }

    throw GradleException("Unsupported OS: ${DefaultNativePlatform.currentOperatingSystem}")
}

def registerGlobalTask(String taskName) {
    tasks.register(taskName) {
        group = "custom"
        description = "Global $taskName task that runs $taskName in all subprojects"
        ":airbyte-integrations:connectors:"

        def connectorProjects = subprojects.findAll { it.path.startsWith(":airbyte-integrations:connectors:") }
        println "Registering global task $taskName for ${connectorProjects.size()} connector projects: ${connectorProjects.name.join(', ')}"
        dependsOn connectorProjects.collect { it.tasks.named(taskName) }
    }
}


